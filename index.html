<!DOCTYPE html>
<html>
<head>
	<title>OhMyCookie</title>
	<link rel="stylesheet" href="css/main.css">

	<style type="text/css">
		*{
			margin: 0;
		}
		#paper{
			border: 1px solid black;
		}
	</style>

	<script type = "text/javascript" src = "https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>

<body>
	<canvas id="paper" width="0" height="0">
		

	</canvas>
	<div class="response"></div>

	<script type="text/javascript">	
		var c = document.getElementById("paper");
		var ctx = c.getContext("2d");
		ctx.moveTo(0,0);
		var x0 = 0;
		var y0 = 0;
		var x1 = 0;
		var y1 = 0;

		// Begin
		init();	

		// Draw
		$( "#paper" ).mousemove(function( event ) {
			x0 = x1;
			y0 = y1;
			x1 = event.pageX;
			y1 = event.pageY;
			if(isClicking)
			{
				ctx.moveTo(x0, y0);
				ctx.lineTo(x1, y1);
				ctx.stroke();
			}
		});

		// Check if the mouse is dragging / clicking / mousedown
		var isClicking = false;
		$( "#paper" ).mousedown(function(){
			isClicking = true;
		})
		.mouseup(function(){
		    isClicking = false;
		});

		// Resize paper
		function init(){
			var width = $(window).width() - 7;
			var height = $(window).height() - 7;

			// Always 16:9 aspect ratio
			if((width / (16/9)) < height)
			{
				c.width = width;
				c.height = width / (16/9);
			}
			else
			{
				c.width = height / (9/16);
				c.height = height;
			}
			clear();
			console.log("Paper initialised to " + c.width + "*" + c.height)
		}

		function clear(){
			ctx.clearRect(0, 0, c.width, c.height);
			c.width = c.width;
			return(null)
		}

		function send(){
			var image = c.toDataURL("image/png");
			$.post(
				"upload_data.php",
				{
					hidden_data: image	
				},
				function(data, status){
					console.log("Image sent");
				}				
			)
		}

		function load(){
			$.post(
				"load_img.php",
				{
					hidden_data: "yerd"	
				},
				function(data, status){
					var imgToLoad = new Image();
					imgToLoad.onload = function(){
						ctx.drawImage(this, 0, 0);
						console.log("Image loaded");
					}
					imgToLoad.src = data;
				}				
			)
		}

		var endLoop = false;
		function beginLoop(){
			endLoop = false;
			setTimeout(function(){
				load();    
				if (!endLoop) beginLoop()
			}, 350)
		}

		function stopLoop(){
			endLoop = true;
		}
	</script>
</body>
</html>
